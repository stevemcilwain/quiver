#!/usr/bin/env zsh

############################################################# 
# qq-exploit
#############################################################

qq-exploit-help() {
  cat << "DOC"

qq-exploit
----------
The exploit namespace provides commands that assist with compilation and
cross-compilation commands for exploits.

Commands
--------
qq-exploit-install:               installs dependencies
qq-exploit-searchsploit-nmap:     use searchsploit with an nmap xml results file
qq-exploit-compile-gcc:           compile a linux exploit
qq-exploit-compile-gcc-32:        compile a linux 32 exploit on 64
qq-exploit-compile-c-win32:       cross compile a C win32 exploit
qq-exploit-compile-c-win64:       cross compile a C wind64 exploit
qq-exploit-compile-c++-win32:     cross compile a C++ win32 exploit
qq-exploit-compile-c++-win64:     cross compile a C++ win64 exploit

DOC
}

qq-exploit-install() {
  sudo dpkg --add-architecture i386
  sudo apt-get update
  __pkgs exploitdb
  __pkgs mingw-w64 gcc gcc-multilib g++-multilib
}

qq-exploit-searchsploit-nmap() {
  __check-project
  __ask "Select nmap xml scan results file"
  local f && __askpath f FILE ${__PROJECT}
  print -z "searchsploit -x --nmap ${f}"
}

qq-exploit-compile-gcc() {
  __check-project
  mkdir -p ${__PROJECT}/exploits
  local src && __askpath src SOURCE ${__PROJECT}/exploits
  local out && __askpath out OUTPUT ${__PROJECT}/exploits
  print -z "gcc -o ${out} ${src}"
}

qq-exploit-compile-gcc-32() {
  __check-project
  mkdir -p ${__PROJECT}/exploits
  local src && __askpath src SOURCE ${__PROJECT}/exploits
  local out && __askpath out OUTPUT ${__PROJECT}/exploits
  print -z "gcc -m32 -o ${out} ${src}"
}

qq-exploit-compile-c-win32() {
  __check-project
  mkdir -p ${__PROJECT}/exploits
  local src && __askpath src SOURCE ${__PROJECT}/exploits
  local out && __askpath out OUTPUT ${__PROJECT}/exploits
  print -z "i686-w64-mingw32-gcc ${src} -o ${out}"
}

qq-exploit-compile-c-win64() {
  __check-project
  mkdir -p ${__PROJECT}/exploits
  local src && __askpath src SOURCE ${__PROJECT}/exploits
  local out && __askpath out OUTPUT ${__PROJECT}/exploits
  print -z "x86_64-w64-mingw32-gcc ${src} -o ${out}"
}

qq-exploit-compile-c++-win32() {
  __check-project
  mkdir -p ${__PROJECT}/exploits
  local src && __askpath src SOURCE ${__PROJECT}/exploits
  local out && __askpath out OUTPUT ${__PROJECT}/exploits
  print -z "i686-w64-mingw32-g++ ${src} -o ${out}"
}

qq-exploit-compile-c++-win64() {
  __check-project
  mkdir -p ${__PROJECT}/exploits
  local src && __askpath src SOURCE ${__PROJECT}/exploits
  local out && __askpath out OUTPUT ${__PROJECT}/exploits
  print -z "x86_64-w64-mingw32-g++ ${src} -o ${out}"
}

qq-exploit-compile-notes-winsock() {
  __info "use -lws2_32"
}

qq-exploit-compile-notes-static() {
  __info "-static-libstdc++"
  __info "-static-libgcc"
}
